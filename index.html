<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Planilha Controle de Desconto RJ x ES</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Fonte Aptos Display (fallback local) -->
<style>
@font-face {
    font-family: 'Aptos Display';
    src: local('Aptos Display'), local('AptosDisplay');
}
</style>

<style>
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        background: #F5F7FA;
        margin: 0;
        padding: 0;
    }

    .header {
        width: 100%;
        padding: 40px 20px;
        background: #0A3D62;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        position: relative;
        box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    .header img {
        height: 105px;
        position: absolute;
        left: 25px;
        top: 50%;
        transform: translateY(-50%);
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.35));
    }

    .header-title {
        font-family: 'Aptos Display', 'Segoe UI', Arial, sans-serif;
        font-size: 34px;
        font-weight: 900;
        letter-spacing: 2px;
        text-transform: uppercase;
        text-shadow: 
            0 0 4px rgba(255,255,255,0.65),
            0 2px 2px rgba(0,0,0,0.35);
    }

    .container {
        max-width: 960px;
        background: #FFFFFF;
        margin: 40px auto;
        padding: 35px;
        border-radius: 14px;
        box-shadow: 0 4px 18px rgba(0,0,0,0.1);
    }

    .section-title {
        font-size: 20px;
        margin-top: 25px;
        margin-bottom: 10px;
        font-weight: bold;
        color: #0A3D62;
        border-left: 5px solid #1B7FC2;
        padding-left: 10px;
    }

    label {
        display: block;
        margin: 10px 0 6px;
        font-weight: 600;
        color: #0A3D62;
    }

    input, select, textarea {
        width: 100%;
        padding: 13px;
        font-size: 15px;
        border-radius: 8px;
        border: 1px solid #C5D9E8;
        background: #F9FCFF;
        transition: 0.2s;
        box-sizing: border-box;
    }

    textarea {
        min-height: 90px;
    }

    .materials-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        margin-top: 15px;
    }

    .materials-table th {
        background: #0A3D62;
        color: white;
        padding: 12px;
        text-align: left;
    }

    .materials-table td {
        border: 1px solid #ddd;
        padding: 10px;
    }

    .btn-add {
        margin-top: 20px;
        background: #1B7FC2;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: 0.2s;
    }

    .btn-add:hover { background: #145A8A; }

    .materials-table button {
        background: #D9534F;
        color: white;
        border: none;
        padding: 7px 14px;
        border-radius: 6px;
        cursor: pointer;
    }

    .materials-table button:hover { background: #B52B27; }

    .total-box {
        background: #D8ECFF;
        padding: 18px;
        border-radius: 10px;
        font-size: 22px;
        font-weight: bold;
        margin-top: 25px;
        text-align: right;
        border: 1px solid #A3D4FF;
        color: #0A3D62;
    }

    .submit-btn {
        margin-top: 35px;
        width: 100%;
        padding: 17px;
        background: #0A3D62;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        text-transform: uppercase;
    }

    .success-box {
        margin-top: 25px;
        display: none;
        background: #D4EDDA;
        color: #155724;
        border: 1px solid #A3D4A5;
        padding: 18px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
    }

    .image-preview-box {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 10px;
    }

    .image-item {
        position: relative;
        width: 130px;
        height: 130px;
    }

    .image-item img {
        width: 100%;
        height: 100%;
        border-radius: 8px;
        object-fit: cover;
        border: 2px solid #C5D9E8;
    }

    .remove-img {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #D9534F;
        color: white;
        border: none;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        cursor: pointer;
    }
</style>
</head>

<body>

<div class="header">
    <img src="logohallen.png" alt="Logo Hallen">
    <div class="header-title">Planilha Controle de Desconto RJ x ES</div>
</div>

<div class="container">

    <div id="successBox" class="success-box">✔ Formulário enviado com sucesso!</div>

    <div id="formulario">

        <div class="section-title">Dados do Técnico</div>

        <label>Nome do Técnico</label>
        <input type="text" id="tec_nome">

        <label>Data do Desconto</label>
        <input type="date" id="data_desc">

        <label>Motivo do Desconto</label>
        <select id="motivoSelect">
            <option value="">Selecione...</option>
            <option value="nada consta">Nada Consta</option>
            <option value="perda">Perda</option>
            <option value="aging">Aging</option>
            <option value="reversa">Reversa</option>
            <option value="furto">Furto</option>
        </select>

        <div class="section-title">Informações do Desconto</div>

        <label>Descontado pela Vivo?</label>
        <select id="vivo">
            <option value="">Selecione...</option>
            <option value="sim">Sim</option>
            <option value="nao">Não</option>
        </select>

        <label>Desconto enviado para o RH?</label>
        <select id="rh">
            <option value="">Selecione...</option>
            <option value="sim">Sim</option>
            <option value="nao">Não</option>
        </select>

        <label>Assinatura do Técnico</label>
        <select id="assinatura">
            <option value="">Selecione...</option>
            <option value="sim">Sim</option>
            <option value="nao">Não</option>
            <option value="testemunha">Testemunha</option>
        </select>

        <div class="section-title">Materiais / Ferramental / Serializados</div>

        <table class="materials-table" id="materialsTable">
            <tr>
                <th>Descrição</th>
                <th>Valor (R$)</th>
                <th>Ação</th>
            </tr>
        </table>

        <button class="btn-add" id="btnAddMaterial">+ Adicionar Descrição</button>

        <div class="total-box">
            Valor Total: R$ <span id="totalValue">0.00</span>
        </div>

        <div class="section-title">Responsável e Evidências</div>

        <label>Responsável pelo Desconto</label>
        <input type="text" id="resp">

        <label>Justificativa</label>
        <textarea id="just"></textarea>

        <label>Carta de Desconto (PDF)</label>
        <input type="file" id="pdf" accept="application/pdf">

        <label>Comprovante de Recebimento (Até 5 Imagens)</label>
        <input type="file" id="comprovantes" accept="image/*" multiple>

        <div id="preview" class="image-preview-box"></div>

        <button class="submit-btn" id="btnEnviar" type="button">Enviar Formulário</button>

    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    try {
        const btnAdd = document.getElementById('btnAddMaterial');
        const btnEnviar = document.getElementById('btnEnviar');
        const comprovantesInput = document.getElementById('comprovantes');

        btnAdd.addEventListener('click', function (e) {
            e.preventDefault();
            addMaterial();
        });

        // imagens
        let imagensSelecionadas = [];
        comprovantesInput.addEventListener('change', function () {
            const arquivos = Array.from(this.files);
            if (imagensSelecionadas.length + arquivos.length > 5) {
                alert("Você só pode enviar até 5 imagens.");
                return;
            }
            arquivos.forEach(arq => {
                const leitor = new FileReader();
                leitor.onload = function (ev) {
                    imagensSelecionadas.push(ev.target.result);
                    atualizarPreview();
                };
                leitor.readAsDataURL(arq);
            });
        });

        function atualizarPreview() {
            const preview = document.getElementById('preview');
            preview.innerHTML = '';
            imagensSelecionadas.forEach((img, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'image-item';
                const image = document.createElement('img');
                image.src = img;
                const btn = document.createElement('button');
                btn.className = 'remove-img';
                btn.type = 'button';
                btn.innerText = 'X';
                btn.addEventListener('click', () => {
                    imagensSelecionadas.splice(index, 1);
                    atualizarPreview();
                });
                wrapper.appendChild(image);
                wrapper.appendChild(btn);
                preview.appendChild(wrapper);
            });
        }

        // Exponha funções para o escopo do envio
        window._imagensSelecionadas = imagensSelecionadas;
        window._atualizarPreview = atualizarPreview;

        btnEnviar.addEventListener('click', function (e) {
            e.preventDefault();
            enviarFormulario();
        });

        // Funções existentes (reaproveitadas)
        window.addMaterial = function () {
            const table = document.getElementById("materialsTable");
            const row = table.insertRow();
            row.innerHTML = `
                <td><input type="text" class="desc"></td>
                <td><input type="number" class="valor" step="0.01" oninput="calcularTotal()"></td>
                <td><button onclick="removerLinha(this)">Remover</button></td>
            `;
        };

        window.removerLinha = function (btn) {
            btn.parentNode.parentNode.remove();
            calcularTotal();
        };

        window.calcularTotal = function () {
            let total = 0;
            document.querySelectorAll(".valor").forEach(v => {
                if (v.value) total += parseFloat(v.value);
            });
            document.getElementById("totalValue").innerText = total.toFixed(2);
        };

        window.enviarFormulario = function () {
            try {
                // mostra mensagem
                document.getElementById("successBox").style.display = "block";
                console.log('Formulário enviado — limpando campos.');

                // limpar inputs text / date / textarea
                document.getElementById("tec_nome").value = "";
                document.getElementById("data_desc").value = "";
                document.getElementById("resp").value = "";
                document.getElementById("just").value = "";

                // limpar selects
                document.getElementById("motivoSelect").value = "";
                document.getElementById("vivo").value = "";
                document.getElementById("rh").value = "";
                document.getElementById("assinatura").value = "";

                // limpar arquivos
                document.getElementById("pdf").value = "";
                comprovantesInput.value = "";

                // limpar imagens em memória e preview
                imagensSelecionadas.length = 0;
                atualizarPreview();

                // limpar tabela (recria o cabeçalho)
                const tabela = document.getElementById("materialsTable");
                tabela.innerHTML = `
                    <tr>
                        <th>Descrição</th>
                        <th>Valor (R$)</th>
                        <th>Ação</th>
                    </tr>
                `;

                // reset total
                document.getElementById("totalValue").innerText = "0.00";

                // esconder mensagem após 4s
                setTimeout(() => {
                    document.getElementById("successBox").style.display = "none";
                }, 4000);

            } catch (err) {
                console.error('Erro em enviarFormulario:', err);
                alert('Ocorreu um erro ao enviar o formulário. Veja o console para detalhes.');
            }
        };

        console.log('Scripts inicializados com sucesso.');

    } catch (err) {
        console.error('Erro ao inicializar scripts:', err);
    }
});
</script>

</body>
</html>










